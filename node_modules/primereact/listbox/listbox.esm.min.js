import*as e from"react";import{FilterService as t}from"primereact/api";import{Tooltip as l}from"primereact/tooltip";import{classNames as n,ObjectUtils as r,DomHandler as a}from"primereact/utils";import{VirtualScroller as o}from"primereact/virtualscroller";import{InputText as i}from"primereact/inputtext";import{Ripple as u}from"primereact/ripple";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},c.apply(this,arguments)}function s(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,n=new Array(t);l<t;l++)n[l]=e[l];return n}function f(e){if(Array.isArray(e))return p(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?p(e,t):void 0}}function b(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e){return f(e)||m(e)||d(e)||b()}function y(e){if(Array.isArray(e))return e}function h(e,t){var l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var n,r,a=[],o=!0,i=!1;try{for(l=l.call(e);!(o=(n=l.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw r}}return a}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var E=e.memo((function(t){return e.createElement("div",{className:"p-listbox-header"},e.createElement("div",{className:"p-listbox-filter-container"},e.createElement(i,c({type:"text",value:t.filter,onChange:function(e){t.onFilter&&t.onFilter({originalEvent:e,value:e.target.value})},className:"p-listbox-filter",disabled:t.disabled,placeholder:t.filterPlaceholder},t.filterInputProps)),e.createElement("span",{className:"p-listbox-filter-icon pi pi-search"})))}));E.displayName="ListBoxHeader";var x=e.memo((function(t){var l=function(e){t.onClick&&t.onClick({originalEvent:e,option:t.option}),e.preventDefault()},o=function e(t){var l=t.nextElementSibling;return l?a.hasClass(l,"p-disabled")||a.hasClass(l,"p-listbox-item-group")?e(l):l:null},i=function e(t){var l=t.previousElementSibling;return l?a.hasClass(l,"p-disabled")||a.hasClass(l,"p-listbox-item-group")?e(l):l:null},c=n("p-listbox-item",{"p-highlight":t.selected,"p-disabled":t.disabled},t.option.className),s=t.template?r.getJSXElement(t.template,t.option):t.label;return e.createElement("li",{className:c,onClick:l,onTouchEnd:function(e){t.onTouchEnd&&t.onTouchEnd({originalEvent:e,option:t.option})},onKeyDown:function(e){var t=e.currentTarget;switch(e.which){case 40:var n=o(t);n&&n.focus(),e.preventDefault();break;case 38:var r=i(t);r&&r.focus(),e.preventDefault();break;case 13:l(e),e.preventDefault()}},tabIndex:"-1","aria-label":t.label,key:t.label,role:"option","aria-selected":t.selected,"aria-disabled":t.disabled},s,e.createElement(u,null))}));function O(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,n)}return l}function S(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?O(Object(l),!0).forEach((function(t){s(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):O(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function w(e,t){var l="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!l){if(Array.isArray(e)||(l=C(e))||t&&e&&"number"==typeof e.length){l&&(e=l);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){l=l.call(e)},n:function(){var e=l.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==l.return||l.return()}finally{if(i)throw a}}}}function C(e,t){if(e){if("string"==typeof e)return D(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,n=new Array(t);l<t;l++)n[l]=e[l];return n}x.displayName="ListBoxItem";var L=e.memo(e.forwardRef((function(a,i){var u,s,p=e.useState(""),f=(s=2,y(u=p)||h(u,s)||d(u,s)||g()),m=f[0],b=f[1],O=e.useRef(null),C=e.useRef(null),D=e.useRef(!1),P=(a.onFilterValueChange?a.filterValue:m)||"",j=P&&P.trim().length>0,N=function(e){var t=e.option;a.disabled||R(t)||(a.multiple?F(e.originalEvent,t):T(e.originalEvent,t),D.current=!1)},I=function(){a.disabled||(D.current=!0)},T=function(e,t){var l=G(t),n=!1,r=null;!D.current&&a.metaKeySelection?l?(e.metaKey||e.ctrlKey)&&(r=null,n=!0):(r=M(t),n=!0):(r=l?null:M(t),n=!0);n&&K(e,r)},F=function(e,t){var l=G(t),n=!1,r=null;if(!D&&a.metaKeySelection){var o=e.metaKey||e.ctrlKey;l?(r=o?k(t):[M(t)],n=!0):(r=[].concat(v(r=o&&a.value||[]),[M(t)]),n=!0)}else r=l?k(t):[].concat(v(a.value||[]),[M(t)]),n=!0;n&&a.onChange({originalEvent:e,value:r,stopPropagation:function(){},preventDefault:function(){},target:{name:a.name,id:a.id,value:r}})},A=function(e){var t=e.value;a.onFilterValueChange?a.onFilterValueChange({originalEvent:e.originalEvent,value:t}):b(t)},K=function(e,t){a.onChange&&a.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:a.name,id:a.id,value:t}})},k=function(e){return a.value.filter((function(t){return!r.equals(t,M(e),a.dataKey)}))},G=function(e){var t=M(e);return a.multiple&&a.value?a.value.some((function(e){return r.equals(e,t,a.dataKey)})):r.equals(a.value,t,a.dataKey)},V=function(e){return a.optionLabel?r.resolveFieldData(e,a.optionLabel):e&&void 0!==e.label?e.label:e},M=function(e){return a.optionValue?r.resolveFieldData(e,a.optionValue):e&&void 0!==e.value?e.value:e},B=function(e){return a.dataKey?r.resolveFieldData(e,a.dataKey):V(e)},R=function(e){return a.optionDisabled?r.isFunction(a.optionDisabled)?a.optionDisabled(e):r.resolveFieldData(e,a.optionDisabled):!(!e||void 0===e.disabled)&&e.disabled},_=function(e){return r.resolveFieldData(e,a.optionGroupLabel)},q=function(e){return r.resolveFieldData(e,a.optionGroupChildren)},z=function(t){return q(t).map((function(t,l){var n=V(t),r=l+"_"+B(t),o=R(t),i=o?null:a.tabIndex||0;return e.createElement(x,{key:r,label:n,option:t,template:a.itemTemplate,selected:G(t),onClick:N,onTouchEnd:I,tabIndex:i,disabled:o})}))},J=function(t,l){if(a.optionGroupLabel){var n=a.optionGroupTemplate?r.getJSXElement(a.optionGroupTemplate,t,l):r.resolveFieldData(t,a.optionGroupLabel),o=z(t),i=l+"_"+_(t);return e.createElement(e.Fragment,{key:i},e.createElement("li",{className:"p-listbox-item-group",role:"group"},n),o)}var u=V(t),c=l+"_"+B(t),s=R(t),p=s?null:a.tabIndex||0;return e.createElement(x,{key:c,label:u,option:t,template:a.itemTemplate,selected:G(t),onClick:N,onTouchEnd:I,tabIndex:p,disabled:s})},U=function(){if(j){var e=P.trim().toLocaleLowerCase(a.filterLocale),l=a.filterBy?a.filterBy.split(","):[a.optionLabel||"label"];if(a.optionGroupLabel){var n,r=[],o=w(a.options);try{for(o.s();!(n=o.n()).done;){var i=n.value,u=t.filter(q(i),l,e,a.filterMatchMode,a.filterLocale);u&&u.length&&r.push(S(S({},i),{items:u}))}}catch(e){o.e(e)}finally{o.f()}return r}return t.filter(a.options,l,e,a.filterMatchMode,a.filterLocale)}return a.options}(),X=r.isNotEmpty(a.tooltip),$=r.findDiffKeys(a,L.defaultProps),H=n("p-listbox p-component",{"p-disabled":a.disabled},a.className),Y=n("p-listbox-list-wrapper",a.listClassName),Q=function(){if(a.virtualScrollerOptions){var t=S(S({},a.virtualScrollerOptions),{items:U,onLazyLoad:function(e){return a.virtualScrollerOptions.onLazyLoad(S(S({},e),{filter:U}))},itemTemplate:function(e,t){return e&&J(e,t.index)},contentTemplate:function(t){var l=n("p-listbox-list",t.className);return e.createElement("ul",{ref:t.contentRef,className:l,role:"listbox","aria-multiselectable":a.multiple,"aria-labelledby":a["aria-labelledby"],"aria-label":a["aria-label"]},t.children)}});return e.createElement(o,c({ref:C},t))}var l=U?U.map(J):null;return e.createElement("ul",{className:"p-listbox-list",role:"listbox","aria-multiselectable":a.multiple,"aria-labelledby":a["aria-labelledby"],"aria-label":a["aria-label"]},l)}(),W=a.filter?e.createElement(E,{filter:P,onFilter:A,disabled:a.disabled,filterPlaceholder:a.filterPlaceholder,filterInputProps:a.filterInputProps}):null;return e.createElement(e.Fragment,null,e.createElement("div",c({ref:O,id:a.id,className:H,style:a.style},$),W,e.createElement("div",{className:Y,style:a.listStyle},Q)),X&&e.createElement(l,c({target:O,content:a.tooltip},a.tooltipOptions)))})));L.displayName="ListBox",L.defaultProps={__TYPE:"ListBox",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,itemTemplate:null,style:null,listStyle:null,listClassName:null,className:null,virtualScrollerOptions:null,disabled:null,dataKey:null,multiple:!1,metaKeySelection:!1,filter:!1,filterBy:null,filterValue:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,filterInputProps:null,tabIndex:0,tooltip:null,tooltipOptions:null,"aria-label":null,"aria-labelledby":null,onChange:null,onFilterValueChange:null};export{L as ListBox};
